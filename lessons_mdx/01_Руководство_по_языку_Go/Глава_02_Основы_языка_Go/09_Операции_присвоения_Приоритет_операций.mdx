# Операции присвоения. Приоритет операций

<Meta>
reading_time: 12
</Meta>

<Overview>
- Оператор `=` присваивает значение уже объявленной переменной
- Оператор `:=` объявляет и инициализирует новую переменную
- **Составные операторы** (`+=`, `-=`, `*=` и др.) — сокращённая запись
- **Приоритет операций** определяет порядок вычислений
- Скобки `()` используются для явного изменения приоритета

### Таблица операторов присвоения

| Оператор | Описание | Эквивалент |
|----------|----------|------------|
| `=` | Присваивание | `a = b` |
| `:=` | Объявление + инициализация | `var a = b` |
| `+=` | Сложение с присваиванием | `a = a + b` |
| `-=` | Вычитание с присваиванием | `a = a - b` |
| `*=` | Умножение с присваиванием | `a = a * b` |
| `/=` | Деление с присваиванием | `a = a / b` |
| `%=` | Остаток с присваиванием | `a = a % b` |
| `&=` | Битовый AND с присваиванием | `a = a & b` |
| `\|=` | Битовый OR с присваиванием | `a = a \| b` |
| `^=` | Битовый XOR с присваиванием | `a = a ^ b` |
| `<<=` | Сдвиг влево с присваиванием | `a = a << b` |
| `>>=` | Сдвиг вправо с присваиванием | `a = a >> b` |
</Overview>

<Theory>
### Присваивание vs Объявление

**= (присваивание)** — изменяет существующую переменную:
```go
var x int  // объявили
x = 10     // присвоили значение
x = 20     // изменили значение
```

**:= (короткое объявление)** — создаёт новую переменную:
```go
x := 10  // объявление + инициализация
```

### Составные операторы

Вместо `x = x + 5` можно писать `x += 5`. Это:
- Короче
- Читаемее
- Вычисляет `x` один раз (важно для сложных выражений)

```go
count += 1      // вместо count = count + 1
total *= price  // вместо total = total * price
flags |= Read   // вместо flags = flags | Read
```

### Множественное присваивание

Go позволяет присваивать несколько значений одновременно:

```go
a, b := 1, 2            // объявить и инициализировать
a, b = b, a             // обменять значения
x, y, z = 1, 2, 3       // несколько присваиваний
```

**Обмен значений** — элегантная особенность Go:
```go
// В других языках нужна временная переменная:
// temp := a; a = b; b = temp

// В Go:
a, b = b, a
```

### Приоритет операций

Когда в выражении несколько операций, Go выполняет их в порядке приоритета:

**От высшего к низшему:**
1. `()` — скобки
2. `*`, `/`, `%`, `<<`, `>>`, `&`, `&^`
3. `+`, `-`, `|`, `^`
4. `==`, `!=`, `<`, `<=`, `>`, `>=`
5. `&&`
6. `||`

**Пример:**
```go
2 + 3 * 4      // = 2 + 12 = 14 (умножение первым)
(2 + 3) * 4    // = 5 * 4 = 20 (скобки меняют порядок)
```

### Когда использовать скобки?

**Обязательно** — когда нужен другой порядок:
```go
result := (a + b) * c
```

**Рекомендуется** — для читаемости:
```go
// Без скобок — нужно помнить приоритет
if a > 0 && b > 0 || c > 0 { }

// Со скобками — намерение очевидно
if (a > 0 && b > 0) || c > 0 { }
```

### Ассоциативность

При одинаковом приоритете операции выполняются **слева направо**:

```go
10 / 2 / 5    // = (10 / 2) / 5 = 5 / 5 = 1
10 - 3 - 2   // = (10 - 3) - 2 = 7 - 2 = 5
```

Исключение: присваивание — справа налево:
```go
a = b = c = 5  // Сначала c=5, потом b=c, потом a=b
// (но в Go это не работает как одно выражение)
```
</Theory>

<Syntax>
### Базовое присваивание
```go
a = 10         // присвоить 10
a = b          // присвоить значение b
a = b + c      // присвоить результат выражения
```

### Множественное присваивание
```go
a, b = 1, 2           // a=1, b=2
a, b = b, a           // обмен значениями
a, b, c = 1, 2, 3     // несколько переменных
```

### Составные операторы
```go
a += b    // a = a + b
a -= b    // a = a - b
a *= b    // a = a * b
a /= b    // a = a / b
a %= b    // a = a % b
```

### Таблица приоритетов (от высшего к низшему)

| Приоритет | Операторы | Ассоциативность |
|-----------|-----------|-----------------|
| 1 (высший) | `()` `[]` `.` | Слева направо |
| 2 | `!` `^` `+` `-` (унарные) | Справа налево |
| 3 | `*` `/` `%` `<<` `>>` `&` `&^` | Слева направо |
| 4 | `+` `-` `\|` `^` | Слева направо |
| 5 | `==` `!=` `<` `<=` `>` `>=` | Слева направо |
| 6 | `&&` | Слева направо |
| 7 | `\|\|` | Слева направо |
| 8 (низший) | `=` `+=` `-=` и др. | Справа налево |
</Syntax>

<Examples>
кода

### Пример 1: Базовое присваивание
```go
package main

import "fmt"

func main() {
    var a int
    a = 10
    fmt.Println("a =", a)  // 10
    
    a = 20
    fmt.Println("a =", a)  // 20
    
    b := 5
    a = b + 3
    fmt.Println("a =", a)  // 8
}
```

### Пример 2: Составные операторы присвоения
```go
package main

import "fmt"

func main() {
    a := 10
    
    a += 5
    fmt.Println("a += 5:", a)  // 15
    
    a -= 3
    fmt.Println("a -= 3:", a)  // 12
    
    a *= 2
    fmt.Println("a *= 2:", a)  // 24
    
    a /= 4
    fmt.Println("a /= 4:", a)  // 6
    
    a %= 4
    fmt.Println("a %= 4:", a)  // 2
}
```

### Пример 3: Битовые операторы присвоения
```go
package main

import "fmt"

func main() {
    a := 5  // 101
    
    a <<= 2  // 10100 = 20
    fmt.Printf("a <<= 2: %d (%b)\n", a, a)
    
    a >>= 1  // 1010 = 10
    fmt.Printf("a >>= 1: %d (%b)\n", a, a)
    
    a &= 7   // 1010 & 0111 = 0010 = 2
    fmt.Printf("a &= 7:  %d (%b)\n", a, a)
    
    a |= 8   // 0010 | 1000 = 1010 = 10
    fmt.Printf("a |= 8:  %d (%b)\n", a, a)
    
    a ^= 3   // 1010 ^ 0011 = 1001 = 9
    fmt.Printf("a ^= 3:  %d (%b)\n", a, a)
}
```

### Пример 4: Множественное присваивание
```go
package main

import "fmt"

func main() {
    // Одновременное присваивание
    a, b, c := 1, 2, 3
    fmt.Println(a, b, c)  // 1 2 3
    
    // Обмен значениями (без временной переменной!)
    a, b = b, a
    fmt.Println("После обмена:", a, b)  // 2 1
    
    // Циклический сдвиг
    a, b, c = b, c, a
    fmt.Println("После сдвига:", a, b, c)  // 1 3 2
}
```

### Пример 5: Приоритет операций
```go
package main

import "fmt"

func main() {
    // Умножение до сложения
    a := 2 + 3 * 4
    fmt.Println("2 + 3 * 4 =", a)  // 14 (не 20!)
    
    // Скобки меняют порядок
    b := (2 + 3) * 4
    fmt.Println("(2 + 3) * 4 =", b)  // 20
    
    // Сравнение после арифметики
    c := 5 + 3 > 4 + 2
    fmt.Println("5 + 3 > 4 + 2:", c)  // true (8 > 6)
    
    // && до ||
    d := true || false && false
    fmt.Println("true || false && false:", d)  // true
    
    e := (true || false) && false
    fmt.Println("(true || false) && false:", e)  // false
}
```

### Пример 6: Ассоциативность
```go
package main

import "fmt"

func main() {
    // Слева направо для арифметики
    a := 100 / 10 / 2
    fmt.Println("100 / 10 / 2 =", a)  // 5 (не 20!)
    // Вычисляется как (100 / 10) / 2 = 10 / 2 = 5
    
    // Справа налево для присваивания
    var x, y, z int
    x = y = z = 10  // Работает!
    fmt.Println(x, y, z)  // 10 10 10
}
```

### Пример 7: Практические примеры
```go
package main

import "fmt"

func main() {
    // Накопление суммы
    sum := 0
    for i := 1; i <= 10; i++ {
        sum += i
    }
    fmt.Println("Сумма 1-10:", sum)  // 55
    
    // Подсчёт
    count := 0
    for _, ch := range "hello world" {
        if ch == 'l' {
            count++
        }
    }
    fmt.Println("Букв 'l':", count)  // 3
    
    // Вычисление факториала
    fact := 1
    n := 5
    for i := 1; i <= n; i++ {
        fact *= i
    }
    fmt.Printf("%d! = %d\n", n, fact)  // 5! = 120
}
```

### Пример 8: Сложные выражения
```go
package main

import "fmt"

func main() {
    a, b, c := 10, 5, 2
    
    // Сложное выражение
    result := a + b*c - a/b + a%c
    // = 10 + 10 - 2 + 0 = 18
    fmt.Println("Результат:", result)
    
    // Пошагово (для понимания приоритета):
    step1 := b * c      // 5 * 2 = 10
    step2 := a / b      // 10 / 5 = 2
    step3 := a % c      // 10 % 2 = 0
    step4 := a + step1  // 10 + 10 = 20
    step5 := step4 - step2  // 20 - 2 = 18
    step6 := step5 + step3  // 18 + 0 = 18
    
    fmt.Println("Пошагово:", step6)
}
```
</Examples>

<Pitfalls>
### 1. Путаница = и ==
```go
// ❌ Неправильно — присваивание вместо сравнения
x := 5
if x = 10 {  // В Go это ошибка компиляции!
    // ...
}

// ✅ Правильно
if x == 10 {
    // ...
}
```

### 2. := вместо = для существующей переменной
```go
// ❌ Неправильно
x := 5
x := 10  // no new variables on left side of :=

// ✅ Правильно
x := 5
x = 10  // переприсвоение
```

### 3. Неожиданный приоритет
```go
// ❌ Неожиданный результат
a := 1 << 2 + 3  // Это 1 << (2 + 3) = 1 << 5 = 32
// Потому что + имеет меньший приоритет чем <<

// ✅ Используйте скобки для ясности
a := (1 << 2) + 3  // 4 + 3 = 7
```

### 4. Операторы присвоения не возвращают значение
```go
// ❌ Неправильно — в Go присвоение не выражение
x := 5
y := (x += 3)  // syntax error

// ✅ Правильно
x := 5
x += 3
y := x
```

### 5. Изменение переменной в том же выражении
```go
// ❌ Опасно — порядок вычисления не определён
x := 5
y := x + (x = 10)  // В Go это не скомпилируется

// ✅ Правильно — отдельные инструкции
x := 5
y := x + 10
x = 10
```
</Pitfalls>

<Task id="1" points="5">
<Title>Задание 1: Составное присваивание +=</Title>
<Prompt>
Используйте оператор += для накопления суммы чисел от 1 до 5.
</Prompt>
<Hints>
- `sum += n` эквивалентно `sum = sum + n`
- Это сокращённая форма записи
</Hints>
<StarterCode>
```go
package main

import "fmt"

func main() {
    sum := 0
    fmt.Println("Начало: sum =", sum)
    // Добавьте числа от 1 до 5
}
```
</StarterCode>
<ExpectedOutput>
Начало: sum = 0
sum += 1 → 1
sum += 2 → 3
sum += 3 → 6
sum += 4 → 10
sum += 5 → 15
</ExpectedOutput>
</Task>

<Task id="2" points="10">
<Title>Задание 2: Все составные операторы</Title>
<Prompt>
Продемонстрируйте все составные операторы присваивания: +=, -=, *=, /=, %=.
</Prompt>
<Hints>
- Каждый оператор изменяет x на месте
- Порядок операций важен для результата
</Hints>
<StarterCode>
```go
package main

import "fmt"

func main() {
    x := 20
    fmt.Println("x =", x)
    // Примените все составные операторы
}
```
</StarterCode>
<ExpectedOutput>
x = 20
x += 5  → 25
x -= 10 → 15
x *= 2  → 30
x /= 3  → 10
x %= 4  → 2
</ExpectedOutput>
</Task>

<Task id="3" points="15">
<Title>Задание 3: Побитовые составные операторы</Title>
<Prompt>
Продемонстрируйте побитовые составные операторы: &=, |=, ^=, <<=, >>=.
</Prompt>
<Hints>
- &= применяет побитовое И и присваивает
- <<= сдвигает влево и присваивает
</Hints>
<StarterCode>
```go
package main

import "fmt"

func main() {
    x := 12
    fmt.Printf("x = %d (%b)\n", x, x)
    // Примените побитовые операторы
}
```
</StarterCode>
<ExpectedOutput>
x = 12 (1100)
x &= 10 → 8 (1000)
x |= 3  → 11 (1011)
x ^= 6  → 13 (1101)
x <<= 1 → 26 (11010)
x >>= 2 → 6 (110)
</ExpectedOutput>
</Task>

<Task id="4" points="15">
<Title>Задание 4: Приоритет операций</Title>
<Prompt>
Продемонстрируйте приоритет операций в Go: умножение/деление → сложение/вычитание → сравнение → логические.
</Prompt>
<Hints>
- Скобки имеют наивысший приоритет
- && выполняется раньше ||
</Hints>
<StarterCode>
```go
package main

import "fmt"

func main() {
    // Покажите приоритет операций
}
```
</StarterCode>
<ExpectedOutput>
2 + 3 * 4 = 14 (не 20)
10 - 4 / 2 = 8 (не 3)
5 > 3 && 2 < 4 = true
5 > 3 || 2 > 4 = true
</ExpectedOutput>
</Task>

<Task id="5" points="15">
<Title>Задание 5: Практический пример с присваиваниями</Title>
<Prompt>
Создайте счётчик очков в игре с бонусами и штрафами, используя составные операторы.
</Prompt>
<Hints>
- Это типичный сценарий для игровой механики
- Порядок операций влияет на итог
</Hints>
<StarterCode>
```go
package main

import "fmt"

func main() {
    score := 100
    fmt.Println("Начало игры: очки =", score)
    // Примените игровые действия
}
```
</StarterCode>
<ExpectedOutput>
Начало игры: очки = 100
Бонус +50: очки = 150
Штраф -30: очки = 120
Множитель x2: очки = 240
Деление на команды /4: очки = 60
</ExpectedOutput>
</Task>
