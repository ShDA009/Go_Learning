# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## üí° –ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏

1. **db.Exec** ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ INSERT, UPDATE, DELETE
2. **FormValue** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ä–º—ã
3. **–ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π
4. **Result.LastInsertId** ‚Äî ID –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏
5. **Redirect** ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

---

## üìã –°–∏–Ω—Ç–∞–∫—Å–∏—Å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

```go
result, err := db.Exec("INSERT INTO table (col1, col2) VALUES (?, ?)", val1, val2)

// –ü–æ–ª—É—á–µ–Ω–∏–µ ID –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
id, err := result.LastInsertId()

// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö —Å—Ç—Ä–æ–∫
affected, err := result.RowsAffected()
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã

```go
name := r.FormValue("name")
price := r.FormValue("price")
```

---

## üìñ –¢–µ–æ—Ä–∏—è

### –ü–∞—Ç—Ç–µ—Ä–Ω: —Ñ–æ—Ä–º–∞ ‚Üí –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç

1. **GET** ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø—É—Å—Ç—É—é —Ñ–æ—Ä–º—É
2. **POST** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
3. **Redirect** ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–ø–∏—Å–æ–∫ (PRG –ø–∞—Ç—Ç–µ—Ä–Ω)

```go
func createHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method == http.MethodGet {
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É
        tmpl.Execute(w, nil)
        return
    }
    
    // POST ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    name := r.FormValue("name")
    price := r.FormValue("price")
    
    _, err := db.Exec(
        "INSERT INTO products (name, price) VALUES (?, ?)",
        name, price,
    )
    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }
    
    // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å–ø–∏—Å–æ–∫
    http.Redirect(w, r, "/products", http.StatusSeeOther)
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ ID –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏

```go
result, _ := db.Exec("INSERT INTO products (name) VALUES (?)", name)
id, _ := result.LastInsertId()
fmt.Println("–ù–æ–≤—ã–π ID:", id)
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

```go
func createHandler(w http.ResponseWriter, r *http.Request) {
    name := strings.TrimSpace(r.FormValue("name"))
    priceStr := r.FormValue("price")
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if name == "" {
        http.Error(w, "–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ", http.StatusBadRequest)
        return
    }
    
    price, err := strconv.ParseFloat(priceStr, 64)
    if err != nil || price < 0 {
        http.Error(w, "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞", http.StatusBadRequest)
        return
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    db.Exec("INSERT INTO products (name, price) VALUES (?, ?)", name, price)
    http.Redirect(w, r, "/products", http.StatusSeeOther)
}
```

### PRG (Post/Redirect/Get) –ø–∞—Ç—Ç–µ—Ä–Ω

**–ë–µ–∑ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç F5 ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
- –î—É–±–ª–∏–∫–∞—Ç—ã –≤ –ë–î!

**–° —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º:**
- POST ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Üí Redirect (303) ‚Üí GET —Å–ø–∏—Å–æ–∫
- F5 –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–ø–∏—Å–æ–∫

```go
http.Redirect(w, r, "/products", http.StatusSeeOther)  // 303
```

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –≤—Å—Ç–∞–≤–∫–∞—Ö

```go
tx, _ := db.Begin()
defer tx.Rollback()

result, _ := tx.Exec("INSERT INTO orders (user_id) VALUES (?)", userID)
orderID, _ := result.LastInsertId()

for _, item := range items {
    tx.Exec("INSERT INTO order_items (order_id, product_id) VALUES (?, ?)",
        orderID, item.ProductID)
}

tx.Commit()
```

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (HTML)

**templates/create.html:**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Add Product</title>
    <style>
        form { max-width: 400px; }
        label { display: block; margin-top: 10px; }
        input { width: 100%; padding: 8px; margin-top: 5px; }
        button { margin-top: 15px; padding: 10px 20px; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Add New Product</h1>
    
    {{ if .Error }}
    <p class="error">{{ .Error }}</p>
    {{ end }}
    
    <form action="/create" method="POST">
        <label>Name:
            <input type="text" name="name" required>
        </label>
        
        <label>Price:
            <input type="number" name="price" required min="0">
        </label>
        
        <button type="submit">Add Product</button>
    </form>
    
    <p><a href="/">Back to list</a></p>
</body>
</html>
```

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

```go
package main

import (
    "database/sql"
    "html/template"
    "net/http"
    "strconv"
    
    "github.com/gorilla/mux"
    _ "github.com/go-sql-driver/mysql"
)

type Product struct {
    ID    int
    Name  string
    Price int
}

var database *sql.DB

func main() {
    var err error
    database, err = sql.Open("mysql", "root:password@tcp(localhost:3306)/productdb")
    if err != nil {
        panic(err)
    }
    defer database.Close()
    
    router := mux.NewRouter()
    router.HandleFunc("/", listHandler).Methods("GET")
    router.HandleFunc("/create", createHandler).Methods("GET", "POST")
    
    http.ListenAndServe(":8080", router)
}

func createHandler(w http.ResponseWriter, r *http.Request) {
    // GET ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É
    if r.Method == http.MethodGet {
        tmpl := template.Must(template.ParseFiles("templates/create.html"))
        tmpl.Execute(w, nil)
        return
    }
    
    // POST ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–æ—Ä–º—É
    name := r.FormValue("name")
    priceStr := r.FormValue("price")
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if name == "" {
        showError(w, "Name is required")
        return
    }
    
    price, err := strconv.Atoi(priceStr)
    if err != nil || price < 0 {
        showError(w, "Invalid price")
        return
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ë–î
    result, err := database.Exec(
        "INSERT INTO products (name, price) VALUES (?, ?)",
        name, price,
    )
    if err != nil {
        showError(w, "Database error: "+err.Error())
        return
    }
    
    // –ü–æ–ª—É—á–∞–µ–º ID –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    id, _ := result.LastInsertId()
    _ = id  // –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
    
    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–ø–∏—Å–æ–∫
    http.Redirect(w, r, "/", http.StatusSeeOther)
}

func showError(w http.ResponseWriter, message string) {
    tmpl := template.Must(template.ParseFiles("templates/create.html"))
    tmpl.Execute(w, map[string]string{"Error": message})
}

func listHandler(w http.ResponseWriter, r *http.Request) {
    rows, _ := database.Query("SELECT id, name, price FROM products")
    defer rows.Close()
    
    var products []Product
    for rows.Next() {
        var p Product
        rows.Scan(&p.ID, &p.Name, &p.Price)
        products = append(products, p)
    }
    
    tmpl := template.Must(template.ParseFiles("templates/list.html"))
    tmpl.Execute(w, products)
}
```

### –°–ø–∏—Å–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

**templates/list.html:**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Products</title>
    <style>
        table { border-collapse: collapse; width: 100%; max-width: 600px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #4CAF50; color: white; }
        .actions { margin-bottom: 20px; }
        .btn { padding: 10px 20px; background: #4CAF50; color: white; text-decoration: none; }
    </style>
</head>
<body>
    <h1>Products</h1>
    
    <div class="actions">
        <a href="/create" class="btn">+ Add Product</a>
    </div>
    
    <table>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Price</th>
        </tr>
        {{ range . }}
        <tr>
            <td>{{ .ID }}</td>
            <td>{{ .Name }}</td>
            <td>${{ .Price }}</td>
        </tr>
        {{ else }}
        <tr>
            <td colspan="3">No products yet</td>
        </tr>
        {{ end }}
    </table>
</body>
</html>
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º ID

```go
func createAndGetID(name string, price int) (int64, error) {
    result, err := database.Exec(
        "INSERT INTO products (name, price) VALUES (?, ?)",
        name, price,
    )
    if err != nil {
        return 0, err
    }
    
    return result.LastInsertId()
}

func createHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method == http.MethodPost {
        name := r.FormValue("name")
        price, _ := strconv.Atoi(r.FormValue("price"))
        
        id, err := createAndGetID(name, price)
        if err != nil {
            http.Error(w, err.Error(), 500)
            return
        }
        
        // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
        http.Redirect(w, r, "/product/"+strconv.FormatInt(id, 10), http.StatusSeeOther)
        return
    }
    
    // GET ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É
    tmpl := template.Must(template.ParseFiles("templates/create.html"))
    tmpl.Execute(w, nil)
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```go
type ProductForm struct {
    Name   string
    Price  int
    Errors map[string]string
}

func (f *ProductForm) Validate() bool {
    f.Errors = make(map[string]string)
    
    if strings.TrimSpace(f.Name) == "" {
        f.Errors["name"] = "Name is required"
    } else if len(f.Name) > 100 {
        f.Errors["name"] = "Name is too long (max 100 characters)"
    }
    
    if f.Price < 0 {
        f.Errors["price"] = "Price cannot be negative"
    } else if f.Price > 1000000 {
        f.Errors["price"] = "Price is too high"
    }
    
    return len(f.Errors) == 0
}

func createHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method == http.MethodPost {
        price, _ := strconv.Atoi(r.FormValue("price"))
        
        form := ProductForm{
            Name:  r.FormValue("name"),
            Price: price,
        }
        
        if !form.Validate() {
            tmpl := template.Must(template.ParseFiles("templates/create.html"))
            tmpl.Execute(w, form)
            return
        }
        
        database.Exec(
            "INSERT INTO products (name, price) VALUES (?, ?)",
            form.Name, form.Price,
        )
        
        http.Redirect(w, r, "/", http.StatusSeeOther)
        return
    }
    
    tmpl := template.Must(template.ParseFiles("templates/create.html"))
    tmpl.Execute(w, ProductForm{})
}
```

**templates/create.html —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Add Product</title>
    <style>
        .error { color: red; font-size: 0.9em; }
        input.invalid { border-color: red; }
    </style>
</head>
<body>
    <h1>Add New Product</h1>
    
    <form action="/create" method="POST">
        <label>Name:
            <input type="text" name="name" value="{{ .Name }}"
                   {{ if .Errors.name }}class="invalid"{{ end }}>
            {{ if .Errors.name }}<span class="error">{{ .Errors.name }}</span>{{ end }}
        </label>
        
        <label>Price:
            <input type="number" name="price" value="{{ .Price }}"
                   {{ if .Errors.price }}class="invalid"{{ end }}>
            {{ if .Errors.price }}<span class="error">{{ .Errors.price }}</span>{{ end }}
        </label>
        
        <button type="submit">Add Product</button>
    </form>
</body>
</html>
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### 1. SQL –∏–Ω—ä–µ–∫—Ü–∏–∏

```go
// ‚ùå –ù–ò–ö–û–ì–î–ê —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞–π—Ç–µ
query := "INSERT INTO products (name) VALUES ('" + name + "')"

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
database.Exec("INSERT INTO products (name) VALUES (?)", name)
```

### 2. –ù–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –æ—à–∏–±–∫–∏

```go
// ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
database.Exec("INSERT INTO products (name, price) VALUES (?, ?)", name, price)

// ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—à–∏–±–∫—É
_, err := database.Exec("INSERT INTO products (name, price) VALUES (?, ?)", name, price)
if err != nil {
    // –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
}
```

### 3. –î–≤–æ–π–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã

```go
// ‚ùå –ü–æ—Å–ª–µ POST –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
if r.Method == http.MethodPost {
    database.Exec(...)
    fmt.Fprint(w, "Added!")  // Refresh = –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
}

// ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
if r.Method == http.MethodPost {
    database.Exec(...)
    http.Redirect(w, r, "/", http.StatusSeeOther)
}
```

---

## üèãÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: Redis –∫–ª–∏–µ–Ω—Ç

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Redis.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Redis: rdb := redis.NewClient(&redis.Options{Addr: "localhost:6379"})
```

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

func main() {
    fmt.Println("Redis: rdb := redis.NewClient(&redis.Options{Addr: \"localhost:6379\"})")
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
Redis: rdb := redis.NewClient(&redis.Options{Addr: "localhost:6379"})
```

**–ë–∞–ª–ª—ã:** 10

### –ó–∞–¥–∞–Ω–∏–µ 2: Redis GET/SET

–ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ Redis.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
GET/SET: rdb.Set(ctx, "key", "value", 0); rdb.Get(ctx, "key")
```

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

func main() {
    fmt.Println("GET/SET: rdb.Set(ctx, \"key\", \"value\", 0); rdb.Get(ctx, \"key\")")
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
GET/SET: rdb.Set(ctx, "key", "value", 0); rdb.Get(ctx, "key")
```

**–ë–∞–ª–ª—ã:** 10

### –ó–∞–¥–∞–Ω–∏–µ 3: Redis TTL

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–ª—é—á–∞.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
TTL: rdb.Set(ctx, "key", "value", 1*time.Hour)
```

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

func main() {
    fmt.Println("TTL: rdb.Set(ctx, \"key\", \"value\", 1*time.Hour)")
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
TTL: rdb.Set(ctx, "key", "value", 1*time.Hour)
```

**–ë–∞–ª–ª—ã:** 10

### –ó–∞–¥–∞–Ω–∏–µ 4: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis

–ö–µ—à–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ö–µ—à: check cache -> return OR fetch -> store -> return
```

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

func main() {
    fmt.Println("–ö–µ—à: check cache -> return OR fetch -> store -> return")
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–ö–µ—à: check cache -> return OR fetch -> store -> return
```

**–ë–∞–ª–ª—ã:** 20

### –ó–∞–¥–∞–Ω–∏–µ 5: Redis Pub/Sub

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Pub/Sub.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Pub/Sub: rdb.Publish(), rdb.Subscribe()
```

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

func main() {
    fmt.Println("Pub/Sub: rdb.Publish(), rdb.Subscribe()")
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
Pub/Sub: rdb.Publish(), rdb.Subscribe()
```

**–ë–∞–ª–ª—ã:** 20
