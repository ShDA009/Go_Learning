# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## üí° –ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏

1. **QueryRow + Scan** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
2. **Exec UPDATE** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
3. **–§–æ—Ä–º–∞ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏** ‚Äî UX
4. **ID –≤ URL** ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–ø–∏—Å–∏
5. **RowsAffected** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

## üìã –°–∏–Ω—Ç–∞–∫—Å–∏—Å

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```go
var p Product
err := db.QueryRow("SELECT id, name, price FROM products WHERE id = ?", id).
    Scan(&p.ID, &p.Name, &p.Price)
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

```go
result, err := db.Exec(
    "UPDATE products SET name = ?, price = ? WHERE id = ?",
    name, price, id,
)

affected, _ := result.RowsAffected()
```

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (HTML)

**templates/edit.html:**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Edit Product</title>
    <style>
        form { max-width: 400px; }
        label { display: block; margin-top: 10px; }
        input { width: 100%; padding: 8px; margin-top: 5px; }
        button { margin-top: 15px; padding: 10px 20px; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Edit Product</h1>
    
    {{ if .Error }}
    <p class="error">{{ .Error }}</p>
    {{ end }}
    
    <form action="/edit/{{ .Product.ID }}" method="POST">
        <label>Name:
            <input type="text" name="name" value="{{ .Product.Name }}" required>
        </label>
        
        <label>Price:
            <input type="number" name="price" value="{{ .Product.Price }}" required min="0">
        </label>
        
        <button type="submit">Save Changes</button>
    </form>
    
    <p><a href="/">Back to list</a></p>
</body>
</html>
```

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```go
package main

import (
    "database/sql"
    "html/template"
    "net/http"
    "strconv"
    
    "github.com/gorilla/mux"
    _ "github.com/go-sql-driver/mysql"
)

type Product struct {
    ID    int
    Name  string
    Price int
}

var database *sql.DB

func main() {
    var err error
    database, err = sql.Open("mysql", "root:password@tcp(localhost:3306)/productdb")
    if err != nil {
        panic(err)
    }
    defer database.Close()
    
    router := mux.NewRouter()
    router.HandleFunc("/", listHandler).Methods("GET")
    router.HandleFunc("/edit/{id:[0-9]+}", editHandler).Methods("GET", "POST")
    
    http.ListenAndServe(":8080", router)
}

func editHandler(w http.ResponseWriter, r *http.Request) {
    vars := mux.Vars(r)
    id := vars["id"]
    
    if r.Method == http.MethodGet {
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
        var p Product
        err := database.QueryRow(
            "SELECT id, name, price FROM products WHERE id = ?", id,
        ).Scan(&p.ID, &p.Name, &p.Price)
        
        if err == sql.ErrNoRows {
            http.NotFound(w, r)
            return
        }
        if err != nil {
            http.Error(w, err.Error(), 500)
            return
        }
        
        tmpl := template.Must(template.ParseFiles("templates/edit.html"))
        tmpl.Execute(w, map[string]interface{}{"Product": p})
        return
    }
    
    // POST ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    name := r.FormValue("name")
    price, err := strconv.Atoi(r.FormValue("price"))
    if err != nil {
        http.Error(w, "Invalid price", 400)
        return
    }
    
    result, err := database.Exec(
        "UPDATE products SET name = ?, price = ? WHERE id = ?",
        name, price, id,
    )
    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å
    affected, _ := result.RowsAffected()
    if affected == 0 {
        http.NotFound(w, r)
        return
    }
    
    http.Redirect(w, r, "/", http.StatusSeeOther)
}
```

### –°–ø–∏—Å–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**templates/list.html:**
```html
<!DOCTYPE html>
<html>
<head>
    <title>Products</title>
    <style>
        table { border-collapse: collapse; width: 100%; max-width: 700px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #4CAF50; color: white; }
        .btn { padding: 5px 10px; text-decoration: none; color: white; border-radius: 3px; }
        .btn-edit { background: #2196F3; }
        .btn-delete { background: #f44336; }
        .actions { margin-bottom: 20px; }
        .btn-add { padding: 10px 20px; background: #4CAF50; }
    </style>
</head>
<body>
    <h1>Products</h1>
    
    <div class="actions">
        <a href="/create" class="btn btn-add">+ Add Product</a>
    </div>
    
    <table>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
        {{ range . }}
        <tr>
            <td>{{ .ID }}</td>
            <td>{{ .Name }}</td>
            <td>${{ .Price }}</td>
            <td>
                <a href="/edit/{{ .ID }}" class="btn btn-edit">Edit</a>
                <a href="/delete/{{ .ID }}" class="btn btn-delete" 
                   onclick="return confirm('Are you sure?')">Delete</a>
            </td>
        </tr>
        {{ else }}
        <tr>
            <td colspan="4">No products yet</td>
        </tr>
        {{ end }}
    </table>
</body>
</html>
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

```go
type EditForm struct {
    Product Product
    Errors  map[string]string
}

func editHandler(w http.ResponseWriter, r *http.Request) {
    vars := mux.Vars(r)
    id, _ := strconv.Atoi(vars["id"])
    
    if r.Method == http.MethodGet {
        var p Product
        err := database.QueryRow(
            "SELECT id, name, price FROM products WHERE id = ?", id,
        ).Scan(&p.ID, &p.Name, &p.Price)
        
        if err == sql.ErrNoRows {
            http.NotFound(w, r)
            return
        }
        
        form := EditForm{Product: p}
        renderEdit(w, form)
        return
    }
    
    // POST ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    price, _ := strconv.Atoi(r.FormValue("price"))
    
    form := EditForm{
        Product: Product{
            ID:    id,
            Name:  r.FormValue("name"),
            Price: price,
        },
        Errors: make(map[string]string),
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if form.Product.Name == "" {
        form.Errors["name"] = "Name is required"
    }
    if form.Product.Price < 0 {
        form.Errors["price"] = "Price cannot be negative"
    }
    
    if len(form.Errors) > 0 {
        renderEdit(w, form)
        return
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    database.Exec(
        "UPDATE products SET name = ?, price = ? WHERE id = ?",
        form.Product.Name, form.Product.Price, form.Product.ID,
    )
    
    http.Redirect(w, r, "/", http.StatusSeeOther)
}

func renderEdit(w http.ResponseWriter, form EditForm) {
    tmpl := template.Must(template.ParseFiles("templates/edit.html"))
    tmpl.Execute(w, form)
}
```

### –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (PATCH)

```go
func updatePartial(id int, updates map[string]interface{}) error {
    if len(updates) == 0 {
        return nil
    }
    
    // –°—Ç—Ä–æ–∏–º –∑–∞–ø—Ä–æ—Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
    query := "UPDATE products SET "
    args := []interface{}{}
    first := true
    
    for key, value := range updates {
        if !first {
            query += ", "
        }
        query += key + " = ?"
        args = append(args, value)
        first = false
    }
    
    query += " WHERE id = ?"
    args = append(args, id)
    
    _, err := database.Exec(query, args...)
    return err
}

func patchHandler(w http.ResponseWriter, r *http.Request) {
    vars := mux.Vars(r)
    id, _ := strconv.Atoi(vars["id"])
    
    updates := make(map[string]interface{})
    
    if name := r.FormValue("name"); name != "" {
        updates["name"] = name
    }
    if priceStr := r.FormValue("price"); priceStr != "" {
        if price, err := strconv.Atoi(priceStr); err == nil {
            updates["price"] = price
        }
    }
    
    err := updatePartial(id, updates)
    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }
    
    w.WriteHeader(http.StatusOK)
}
```

### –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

```go
type Product struct {
    ID      int
    Name    string
    Price   int
    Version int  // –î–ª—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
}

func editHandler(w http.ResponseWriter, r *http.Request) {
    vars := mux.Vars(r)
    id := vars["id"]
    
    if r.Method == http.MethodPost {
        name := r.FormValue("name")
        price, _ := strconv.Atoi(r.FormValue("price"))
        version, _ := strconv.Atoi(r.FormValue("version"))
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç
        result, err := database.Exec(
            `UPDATE products 
             SET name = ?, price = ?, version = version + 1 
             WHERE id = ? AND version = ?`,
            name, price, id, version,
        )
        
        if err != nil {
            http.Error(w, err.Error(), 500)
            return
        }
        
        affected, _ := result.RowsAffected()
        if affected == 0 {
            // –î–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            http.Error(w, "Data was modified by another user. Please refresh and try again.", 409)
            return
        }
        
        http.Redirect(w, r, "/", http.StatusSeeOther)
        return
    }
    
    // GET ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Å —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π
    var p Product
    database.QueryRow(
        "SELECT id, name, price, version FROM products WHERE id = ?", id,
    ).Scan(&p.ID, &p.Name, &p.Price, &p.Version)
    
    tmpl := template.Must(template.ParseFiles("templates/edit.html"))
    tmpl.Execute(w, p)
}
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### 1. –ù–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏

```go
// ‚ùå –ú–æ–ª—á–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –æ–±–Ω–æ–≤–∏—Ç
database.Exec("UPDATE products SET name = ? WHERE id = ?", name, 999999)

// ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º RowsAffected
result, _ := database.Exec("UPDATE products SET name = ? WHERE id = ?", name, id)
affected, _ := result.RowsAffected()
if affected == 0 {
    http.NotFound(w, r)
    return
}
```

### 2. Race condition

```go
// ‚ùå –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
// –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–≤–æ–≥–æ

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
UPDATE ... WHERE id = ? AND version = ?
```

---

## üìù –ü—Ä–∞–∫—Ç–∏–∫–∞

### –ó–∞–¥–∞—á–∞ 1: User profile edit
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –ó–∞–¥–∞—á–∞ 2: Inline editing
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º–æ –≤ —Ç–∞–±–ª–∏—Ü–µ (AJAX).

### –ó–∞–¥–∞—á–∞ 3: Bulk edit
–ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π.

### –ó–∞–¥–∞—á–∞ 4: History
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### –ó–∞–¥–∞—á–∞ 5: Draft/Publish
–ß–µ—Ä–Ω–æ–≤–∏–∫–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è.

### –ó–∞–¥–∞—á–∞ 6: Image update
–ó–∞–º–µ–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞.

### –ó–∞–¥–∞—á–∞ 7: Related edit
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### –ó–∞–¥–∞—á–∞ 8: Approval workflow
–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.
