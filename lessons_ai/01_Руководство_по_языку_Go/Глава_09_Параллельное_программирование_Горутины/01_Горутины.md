# –ì–æ—Ä—É—Ç–∏–Ω—ã (Goroutines)

## üí° –ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏

1. **–ì–æ—Ä—É—Ç–∏–Ω–∞** ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π Go runtime
2. **–û–ø–µ—Ä–∞—Ç–æ—Ä go** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é –≥–æ—Ä—É—Ç–∏–Ω—É
3. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º** ‚Äî –≥–æ—Ä—É—Ç–∏–Ω—ã –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–¥—Ä–∞—Ö CPU
4. **–ì–ª–∞–≤–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è `main()`, –ø—Ä–∏ –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É
5. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** ‚Äî –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω
6. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** ‚Äî –≥–æ—Ä—É—Ç–∏–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏, —á–µ–º –ø–æ—Ç–æ–∫–∏ –û–° (~2KB vs ~1MB)

---

## üìñ –¢–µ–æ—Ä–∏—è

### –ß—Ç–æ —Ç–∞–∫–æ–µ –≥–æ—Ä—É—Ç–∏–Ω–∞?

**–ì–æ—Ä—É—Ç–∏–Ω–∞** ‚Äî —ç—Ç–æ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø–æ—Ç–æ–∫, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π Go runtime, –∞ –Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π. –≠—Ç–æ –æ–¥–Ω–∞ –∏–∑ –≥–ª–∞–≤–Ω—ã—Ö —Ñ–∏—à–µ–∫ Go.

```go
go doSomething()  // –∑–∞–ø—É—Å–∫–∞–µ—Ç doSomething –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ
```

### –ì–æ—Ä—É—Ç–∏–Ω—ã vs –ü–æ—Ç–æ–∫–∏ –û–°

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ü–æ—Ç–æ–∫ –û–° | –ì–æ—Ä—É—Ç–∏–Ω–∞ |
|----------------|----------|----------|
| –ü–∞–º—è—Ç—å | ~1MB —Å—Ç–µ–∫ | ~2KB —Å—Ç–µ–∫ |
| –°–æ–∑–¥–∞–Ω–∏–µ | –ú–µ–¥–ª–µ–Ω–Ω–æ (syscall) | –ë—ã—Å—Ç—Ä–æ |
| –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ | –î–æ—Ä–æ–≥–æ | –î—ë—à–µ–≤–æ |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –¢—ã—Å—è—á–∏ | –ú–∏–ª–ª–∏–æ–Ω—ã |

–í Go –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å **100,000+ –≥–æ—Ä—É—Ç–∏–Ω** –±–µ–∑ –ø—Ä–æ–±–ª–µ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–æ —Å –ø–æ—Ç–æ–∫–∞–º–∏ ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø–∞–¥—ë—Ç.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go?

Go –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (scheduler):

```
–ü–æ—Ç–æ–∫–∏ –û–° (M):   [M1]    [M2]    [M3]
                  ‚Üì       ‚Üì       ‚Üì
–ì–æ—Ä—É—Ç–∏–Ω—ã (G):   G1,G4   G2,G5   G3,G6
```

–ù–µ–±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –û–° (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = —á–∏—Å–ª–æ CPU) –∏—Å–ø–æ–ª–Ω—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã –±–µ–∑ —É—á–∞—Å—Ç–∏—è –û–°.

### –ó–∞–ø—É—Å–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
go funcName()           // –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

go func() {             // –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    // –∫–æ–¥
}()                     // () –≤–∞–∂–Ω–æ ‚Äî —ç—Ç–æ –≤—ã–∑–æ–≤!

go func(x int) {        // —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
    fmt.Println(x)
}(42)
```

### –ì–ª–∞–≤–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞

`main()` ‚Äî —ç—Ç–æ —Ç–æ–∂–µ –≥–æ—Ä—É—Ç–∏–Ω–∞. –ö–æ–≥–¥–∞ –æ–Ω–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, **–ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è**, –¥–∞–∂–µ –µ—Å–ª–∏ –¥—Ä—É–≥–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –µ—â—ë —Ä–∞–±–æ—Ç–∞—é—Ç:

```go
func main() {
    go longTask()  // –∑–∞–ø—É—Å—Ç–∏–ª–∏
    // main –∑–∞–≤–µ—Ä—à–∏–ª—Å—è ‚Äî longTask –ø—Ä–µ—Ä–≤—ë—Ç—Å—è!
}
```

### –ö–∞–∫ –¥–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ä—É—Ç–∏–Ω?

**–ü–ª–æ—Ö–æ ‚Äî time.Sleep:**
```go
go doWork()
time.Sleep(time.Second)  // —É–≥–∞–¥—ã–≤–∞–µ–º –≤—Ä–µ–º—è
```

**–•–æ—Ä–æ—à–æ ‚Äî sync.WaitGroup:**
```go
var wg sync.WaitGroup
wg.Add(1)
go func() {
    defer wg.Done()
    doWork()
}()
wg.Wait()  // –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

### –ù–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω**:

```go
for i := 0; i < 3; i++ {
    go fmt.Println(i)
}
// –ú–æ–∂–µ—Ç –≤—ã–≤–µ—Å—Ç–∏: 2, 0, 1 –∏–ª–∏ 0, 1, 2 –∏–ª–∏ –ª—é–±–æ–π –ø–æ—Ä—è–¥–æ–∫
```

### –õ–æ–≤—É—à–∫–∞: –∑–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ü–∏–∫–ª–∞

```go
for i := 0; i < 3; i++ {
    go func() {
        fmt.Println(i)  // –í–µ—Ä–æ—è—Ç–Ω–æ –≤—ã–≤–µ–¥–µ—Ç 3, 3, 3!
    }()
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```go
for i := 0; i < 3; i++ {
    i := i  // —Å–æ–∑–¥–∞—ë–º –ª–æ–∫–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é
    go func() {
        fmt.Println(i)  // —Ç–µ–ø–µ—Ä—å OK
    }()
}
```

---

## üìã –°–∏–Ω—Ç–∞–∫—Å–∏—Å

### –ó–∞–ø—É—Å–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
go functionName(args)      // –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

go func() {               // –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    // –∫–æ–¥
}()

go func(param int) {      // –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    // –∫–æ–¥
}(value)
```

### –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω

```go
// –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
time.Sleep(time.Second)

// –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞
fmt.Scanln()

// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äî sync.WaitGroup (—Å–º. —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫)
```

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
package main

import (
    "fmt"
    "time"
)

func sayHello(name string) {
    for i := 0; i < 3; i++ {
        fmt.Printf("Hello from %s! (%d)\n", name, i)
        time.Sleep(100 * time.Millisecond)
    }
}

func main() {
    // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É
    go sayHello("Goroutine")
    
    // main –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    sayHello("Main")
    
    // –ë–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω—ã
}
```

### –ù–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω

```go
package main

import (
    "fmt"
    "time"
)

func worker(id int) {
    fmt.Printf("Worker %d: started\n", id)
    time.Sleep(time.Second)
    fmt.Printf("Worker %d: finished\n", id)
}

func main() {
    fmt.Println("Starting workers...")
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º 5 –≥–æ—Ä—É—Ç–∏–Ω
    for i := 1; i <= 5; i++ {
        go worker(i)
    }
    
    // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    time.Sleep(2 * time.Second)
    fmt.Println("All workers done!")
}
```

### –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–∞–∫ –≥–æ—Ä—É—Ç–∏–Ω–∞

```go
package main

import (
    "fmt"
    "time"
)

func main() {
    numbers := []int{2, 4, 6, 8, 10}
    
    for _, num := range numbers {
        // –í–ê–ñ–ù–û: –ø–µ—Ä–µ–¥–∞—ë–º num –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä!
        go func(n int) {
            fmt.Printf("Square of %d = %d\n", n, n*n)
        }(num)
    }
    
    time.Sleep(time.Second)
}
```

### –í–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≥–æ—Ä—É—Ç–∏–Ω—ã (—á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª)

```go
package main

import "fmt"

func sum(nums []int, result chan int) {
    total := 0
    for _, n := range nums {
        total += n
    }
    result <- total  // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–∞–Ω–∞–ª
}

func main() {
    numbers := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
    
    ch := make(chan int)
    
    // –î–µ–ª–∏–º —Ä–∞–±–æ—Ç—É –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏
    mid := len(numbers) / 2
    go sum(numbers[:mid], ch)
    go sum(numbers[mid:], ch)
    
    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    x, y := <-ch, <-ch
    fmt.Printf("Sum: %d + %d = %d\n", x, y, x+y)
}
```

### –ì–æ—Ä—É—Ç–∏–Ω–∞ —Å –∑–∞–º—ã–∫–∞–Ω–∏–µ–º

```go
package main

import (
    "fmt"
    "time"
)

func main() {
    message := "Hello"
    
    go func() {
        // –ì–æ—Ä—É—Ç–∏–Ω–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –≤–Ω–µ—à–Ω–µ–π –æ–±–ª–∞—Å—Ç–∏
        fmt.Println(message)
    }()
    
    // ‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤–ª–∏—è–µ—Ç –Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω—É!
    message = "Goodbye"
    
    time.Sleep(100 * time.Millisecond)
}
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

```go
package main

import (
    "fmt"
    "time"
)

func downloadFile(url string) {
    fmt.Printf("Downloading %s...\n", url)
    time.Sleep(2 * time.Second)  // –∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    fmt.Printf("Downloaded %s!\n", url)
}

func main() {
    urls := []string{
        "https://example.com/file1.txt",
        "https://example.com/file2.txt",
        "https://example.com/file3.txt",
    }
    
    start := time.Now()
    
    // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: 6 —Å–µ–∫—É–Ω–¥
    // for _, url := range urls {
    //     downloadFile(url)
    // }
    
    // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~2 —Å–µ–∫—É–Ω–¥—ã
    for _, url := range urls {
        go downloadFile(url)
    }
    
    time.Sleep(3 * time.Second)
    
    fmt.Printf("Total time: %v\n", time.Since(start))
}
```

### GOMAXPROCS ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º

```go
package main

import (
    "fmt"
    "runtime"
)

func main() {
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö CPU
    numCPU := runtime.NumCPU()
    fmt.Printf("Number of CPUs: %d\n", numCPU)
    
    // –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö CPU
    currentProcs := runtime.GOMAXPROCS(0)
    fmt.Printf("Current GOMAXPROCS: %d\n", currentProcs)
    
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU –¥–ª—è –≥–æ—Ä—É—Ç–∏–Ω
    runtime.GOMAXPROCS(2)
    fmt.Printf("Set GOMAXPROCS to: 2\n")
    
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω
    fmt.Printf("Number of goroutines: %d\n", runtime.NumGoroutine())
}
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### 1. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
func main() {
    go func() {
        fmt.Println("Hello from goroutine")
    }()
    // ‚ùå main –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Ä–∞–Ω—å—à–µ, —á–µ–º –≥–æ—Ä—É—Ç–∏–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
}

// ‚úÖ –ù—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω—ã
func main() {
    done := make(chan bool)
    go func() {
        fmt.Println("Hello from goroutine")
        done <- true
    }()
    <-done  // –∂–¥—ë–º —Å–∏–≥–Ω–∞–ª
}
```

### 2. –ó–∞–º—ã–∫–∞–Ω–∏–µ –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ü–∏–∫–ª–∞

```go
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –≤—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –ø–æ–ª—É—á–∞—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ
for i := 0; i < 3; i++ {
    go func() {
        fmt.Println(i)  // –≤–µ—Ä–æ—è—Ç–Ω–æ –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç "3, 3, 3"
    }()
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –ø–µ—Ä–µ–¥–∞—ë–º –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
for i := 0; i < 3; i++ {
    go func(n int) {
        fmt.Println(n)  // –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç "0, 1, 2" (–≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ)
    }(i)
}

// ‚úÖ –ò–ª–∏ —Å–æ–∑–¥–∞—ë–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
for i := 0; i < 3; i++ {
    i := i  // —Å–æ–∑–¥–∞—ë–º –ª–æ–∫–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é
    go func() {
        fmt.Println(i)
    }()
}
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ time.Sleep –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```go
// ‚ùå –ü–õ–û–•–û ‚Äî –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ
go doWork()
time.Sleep(time.Second)

// ‚úÖ –•–û–†–û–®–û ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ WaitGroup –∏–ª–∏ –∫–∞–Ω–∞–ª—ã
var wg sync.WaitGroup
wg.Add(1)
go func() {
    defer wg.Done()
    doWork()
}()
wg.Wait()
```

### 4. –ì–æ—Ä—É—Ç–∏–Ω–∞ –±–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

```go
// ‚ùå –£—Ç–µ—á–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã ‚Äî –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
go func() {
    for {
        // –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –±–µ–∑ –≤—ã—Ö–æ–¥–∞
    }
}()

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–Ω–∞–ª –¥–ª—è –æ—Ç–º–µ–Ω—ã
done := make(chan struct{})
go func() {
    for {
        select {
        case <-done:
            return
        default:
            // —Ä–∞–±–æ—Ç–∞
        }
    }
}()
close(done)  // —Å–∏–≥–Ω–∞–ª –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```

---

## üèãÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: panic

–í—ã–∑–æ–≤–∏—Ç–µ panic –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ù–∞—á–∞–ª–æ
panic: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- panic("—Å–æ–æ–±—â–µ–Ω–∏–µ")
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
- –ü–æ–∫–∞–∑–∞–Ω —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- panic –¥–ª—è –Ω–µ–∏—Å–ø—Ä–∞–≤–∏–º—ã—Ö –æ—à–∏–±–æ–∫
- –ö–æ–¥ –ø–æ—Å–ª–µ panic –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import (
    "errors"
    "fmt"
)

// TODO: –í—ã–∑–æ–≤–∏—Ç–µ panic
// TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

func main() {
    // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–ù–∞—á–∞–ª–æ
panic: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
```

**–ë–∞–ª–ª—ã:** 10

### –ó–∞–¥–∞–Ω–∏–µ 2: recover

–ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç–µ panic —á–µ—Ä–µ–∑ recover.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ: —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- recover() –≤ defer
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ panic
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- defer func() { if r := recover(); r != nil {...} }()
- recover —Ç–æ–ª—å–∫–æ –≤ defer

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

// TODO: –í—ã–∑–æ–≤–∏—Ç–µ panic
// TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ recover –≤ defer
// TODO: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer

func main() {
    // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ: —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
```

**–ë–∞–ª–ª—ã:** 20

### –ó–∞–¥–∞–Ω–∏–µ 3: defer –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ panic

–ü–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ defer –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ panic.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–µ—Å—É—Ä—Å–∞
defer: –∑–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ—Å—É—Ä—Å–∞
panic: –æ—à–∏–±–∫–∞
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- defer –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ panic
- –ü–æ—Ä—è–¥–æ–∫: LIFO
- –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- defer —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Å—Ç–µ–∫–µ
- panic —Ä–∞—Å–∫—Ä—É—á–∏–≤–∞–µ—Ç —Å—Ç–µ–∫, –≤—ã–∑—ã–≤–∞—è defer

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import (
    "errors"
    "fmt"
)

// TODO: –í—ã–∑–æ–≤–∏—Ç–µ panic
// TODO: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer
// TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

func main() {
    // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–µ—Å—É—Ä—Å–∞
defer: –∑–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ—Å—É—Ä—Å–∞
panic: –æ—à–∏–±–∫–∞
```

**–ë–∞–ª–ª—ã:** 15

### –ó–∞–¥–∞–Ω–∏–µ 4: –ü–∞–Ω–∏–∫–∞ –≤ –≥–æ—Ä—É—Ç–∏–Ω–µ

–ü–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ panic –≤ –≥–æ—Ä—É—Ç–∏–Ω–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤ –Ω–µ–π –∂–µ.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ì–æ—Ä—É—Ç–∏–Ω–∞: –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ
–ì–ª–∞–≤–Ω–∞—è: –∑–∞–≤–µ—Ä—à–µ–Ω–æ
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- recover –≤ –≥–æ—Ä—É—Ç–∏–Ω–µ
- –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
- –ü–∞–Ω–∏–∫–∞ –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- –ö–∞–∂–¥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–≤–æ–π recover
- –ë–µ–∑ recover –ø–∞–Ω–∏–∫–∞ —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import (
    "fmt"
    "sync"
    "time"
)

// TODO: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≥–æ—Ä—É—Ç–∏–Ω—É
// TODO: –í—ã–∑–æ–≤–∏—Ç–µ panic
// TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ recover –≤ defer

func main() {
    // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–ì–æ—Ä—É—Ç–∏–Ω–∞: –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ
–ì–ª–∞–≤–Ω–∞—è: –∑–∞–≤–µ—Ä—à–µ–Ω–æ
```

**–ë–∞–ª–ª—ã:** 20

### –ó–∞–¥–∞–Ω–∏–µ 5: panic —Å —Ç–∏–ø–æ–º –æ—à–∏–±–∫–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ error –≤ panic.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–û—à–∏–±–∫–∞: –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- panic(errors.New(...))
- recover –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç error
- Type assertion –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- if err, ok := r.(error); ok {...}
- –ú–æ–∂–Ω–æ panic –ª—é–±—ã–º —Ç–∏–ø–æ–º

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import (
    "errors"
    "fmt"
)

// TODO: –í—ã–∑–æ–≤–∏—Ç–µ panic
// TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ recover –≤ defer
// TODO: –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

func main() {
    // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–û—à–∏–±–∫–∞: –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
```

**–ë–∞–ª–ª—ã:** 20
