# –ì–æ—Ä—É—Ç–∏–Ω—ã (Goroutines)

## üí° –ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏

1. **–ì–æ—Ä—É—Ç–∏–Ω–∞** ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π Go runtime
2. **–û–ø–µ—Ä–∞—Ç–æ—Ä go** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é –≥–æ—Ä—É—Ç–∏–Ω—É
3. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º** ‚Äî –≥–æ—Ä—É—Ç–∏–Ω—ã –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–¥—Ä–∞—Ö CPU
4. **–ì–ª–∞–≤–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è `main()`, –ø—Ä–∏ –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ–∫—Ä–∞—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É
5. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** ‚Äî –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω
6. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** ‚Äî –≥–æ—Ä—É—Ç–∏–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏, —á–µ–º –ø–æ—Ç–æ–∫–∏ –û–° (~2KB vs ~1MB)

---

## üìã –°–∏–Ω—Ç–∞–∫—Å–∏—Å

### –ó–∞–ø—É—Å–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
go functionName(args)      // –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

go func() {               // –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    // –∫–æ–¥
}()

go func(param int) {      // –∞–Ω–æ–Ω–∏–º–Ω–∞—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    // –∫–æ–¥
}(value)
```

### –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω

```go
// –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
time.Sleep(time.Second)

// –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞
fmt.Scanln()

// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äî sync.WaitGroup (—Å–º. —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫)
```

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
package main

import (
    "fmt"
    "time"
)

func sayHello(name string) {
    for i := 0; i < 3; i++ {
        fmt.Printf("Hello from %s! (%d)\n", name, i)
        time.Sleep(100 * time.Millisecond)
    }
}

func main() {
    // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É
    go sayHello("Goroutine")
    
    // main –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    sayHello("Main")
    
    // –ë–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω—ã
}
```

### –ù–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω

```go
package main

import (
    "fmt"
    "time"
)

func worker(id int) {
    fmt.Printf("Worker %d: started\n", id)
    time.Sleep(time.Second)
    fmt.Printf("Worker %d: finished\n", id)
}

func main() {
    fmt.Println("Starting workers...")
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º 5 –≥–æ—Ä—É—Ç–∏–Ω
    for i := 1; i <= 5; i++ {
        go worker(i)
    }
    
    // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    time.Sleep(2 * time.Second)
    fmt.Println("All workers done!")
}
```

### –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–∞–∫ –≥–æ—Ä—É—Ç–∏–Ω–∞

```go
package main

import (
    "fmt"
    "time"
)

func main() {
    numbers := []int{2, 4, 6, 8, 10}
    
    for _, num := range numbers {
        // –í–ê–ñ–ù–û: –ø–µ—Ä–µ–¥–∞—ë–º num –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä!
        go func(n int) {
            fmt.Printf("Square of %d = %d\n", n, n*n)
        }(num)
    }
    
    time.Sleep(time.Second)
}
```

### –í–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≥–æ—Ä—É—Ç–∏–Ω—ã (—á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª)

```go
package main

import "fmt"

func sum(nums []int, result chan int) {
    total := 0
    for _, n := range nums {
        total += n
    }
    result <- total  // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–∞–Ω–∞–ª
}

func main() {
    numbers := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
    
    ch := make(chan int)
    
    // –î–µ–ª–∏–º —Ä–∞–±–æ—Ç—É –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏
    mid := len(numbers) / 2
    go sum(numbers[:mid], ch)
    go sum(numbers[mid:], ch)
    
    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    x, y := <-ch, <-ch
    fmt.Printf("Sum: %d + %d = %d\n", x, y, x+y)
}
```

### –ì–æ—Ä—É—Ç–∏–Ω–∞ —Å –∑–∞–º—ã–∫–∞–Ω–∏–µ–º

```go
package main

import (
    "fmt"
    "time"
)

func main() {
    message := "Hello"
    
    go func() {
        // –ì–æ—Ä—É—Ç–∏–Ω–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –≤–Ω–µ—à–Ω–µ–π –æ–±–ª–∞—Å—Ç–∏
        fmt.Println(message)
    }()
    
    // ‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤–ª–∏—è–µ—Ç –Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω—É!
    message = "Goodbye"
    
    time.Sleep(100 * time.Millisecond)
}
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

```go
package main

import (
    "fmt"
    "time"
)

func downloadFile(url string) {
    fmt.Printf("Downloading %s...\n", url)
    time.Sleep(2 * time.Second)  // –∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    fmt.Printf("Downloaded %s!\n", url)
}

func main() {
    urls := []string{
        "https://example.com/file1.txt",
        "https://example.com/file2.txt",
        "https://example.com/file3.txt",
    }
    
    start := time.Now()
    
    // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: 6 —Å–µ–∫—É–Ω–¥
    // for _, url := range urls {
    //     downloadFile(url)
    // }
    
    // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: ~2 —Å–µ–∫—É–Ω–¥—ã
    for _, url := range urls {
        go downloadFile(url)
    }
    
    time.Sleep(3 * time.Second)
    
    fmt.Printf("Total time: %v\n", time.Since(start))
}
```

### GOMAXPROCS ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º

```go
package main

import (
    "fmt"
    "runtime"
)

func main() {
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö CPU
    numCPU := runtime.NumCPU()
    fmt.Printf("Number of CPUs: %d\n", numCPU)
    
    // –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö CPU
    currentProcs := runtime.GOMAXPROCS(0)
    fmt.Printf("Current GOMAXPROCS: %d\n", currentProcs)
    
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU –¥–ª—è –≥–æ—Ä—É—Ç–∏–Ω
    runtime.GOMAXPROCS(2)
    fmt.Printf("Set GOMAXPROCS to: 2\n")
    
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω
    fmt.Printf("Number of goroutines: %d\n", runtime.NumGoroutine())
}
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### 1. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
func main() {
    go func() {
        fmt.Println("Hello from goroutine")
    }()
    // ‚ùå main –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Ä–∞–Ω—å—à–µ, —á–µ–º –≥–æ—Ä—É—Ç–∏–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
}

// ‚úÖ –ù—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω—ã
func main() {
    done := make(chan bool)
    go func() {
        fmt.Println("Hello from goroutine")
        done <- true
    }()
    <-done  // –∂–¥—ë–º —Å–∏–≥–Ω–∞–ª
}
```

### 2. –ó–∞–º—ã–∫–∞–Ω–∏–µ –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ü–∏–∫–ª–∞

```go
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –≤—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –ø–æ–ª—É—á–∞—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ
for i := 0; i < 3; i++ {
    go func() {
        fmt.Println(i)  // –≤–µ—Ä–æ—è—Ç–Ω–æ –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç "3, 3, 3"
    }()
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –ø–µ—Ä–µ–¥–∞—ë–º –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä
for i := 0; i < 3; i++ {
    go func(n int) {
        fmt.Println(n)  // –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç "0, 1, 2" (–≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ)
    }(i)
}

// ‚úÖ –ò–ª–∏ —Å–æ–∑–¥–∞—ë–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
for i := 0; i < 3; i++ {
    i := i  // —Å–æ–∑–¥–∞—ë–º –ª–æ–∫–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é
    go func() {
        fmt.Println(i)
    }()
}
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ time.Sleep –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```go
// ‚ùå –ü–õ–û–•–û ‚Äî –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ
go doWork()
time.Sleep(time.Second)

// ‚úÖ –•–û–†–û–®–û ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ WaitGroup –∏–ª–∏ –∫–∞–Ω–∞–ª—ã
var wg sync.WaitGroup
wg.Add(1)
go func() {
    defer wg.Done()
    doWork()
}()
wg.Wait()
```

### 4. –ì–æ—Ä—É—Ç–∏–Ω–∞ –±–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

```go
// ‚ùå –£—Ç–µ—á–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã ‚Äî –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
go func() {
    for {
        // –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –±–µ–∑ –≤—ã—Ö–æ–¥–∞
    }
}()

// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–Ω–∞–ª –¥–ª—è –æ—Ç–º–µ–Ω—ã
done := make(chan struct{})
go func() {
    for {
        select {
        case <-done:
            return
        default:
            // —Ä–∞–±–æ—Ç–∞
        }
    }
}()
close(done)  // —Å–∏–≥–Ω–∞–ª –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```

---

## üìù –ü—Ä–∞–∫—Ç–∏–∫–∞

### –ó–∞–¥–∞—á–∞ 1: –°—á—ë—Ç—á–∏–∫
–°–æ–∑–¥–∞–π—Ç–µ 3 –≥–æ—Ä—É—Ç–∏–Ω—ã, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã–≤–æ–¥–∏—Ç —á–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 5 —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å–≤–æ–µ–≥–æ –Ω–æ–º–µ—Ä–∞.

### –ó–∞–¥–∞—á–∞ 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ–∏—Å–∫
–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏—â–µ—Ç –º–∞–∫—Å–∏–º—É–º –≤ –∫–∞–∂–¥–æ–π –ø–æ–ª–æ–≤–∏–Ω–µ –º–∞—Å—Å–∏–≤–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—â–∏–π –º–∞–∫—Å–∏–º—É–º.

### –ó–∞–¥–∞—á–∞ 3: –¢–∞–π–º–µ—Ä
–°–æ–∑–¥–∞–π—Ç–µ –≥–æ—Ä—É—Ç–∏–Ω—É-—Ç–∞–π–º–µ—Ä, –∫–æ—Ç–æ—Ä–∞—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥.

### –ó–∞–¥–∞—á–∞ 4: –ß–∏—Å–ª–∞ –§–∏–±–æ–Ω–∞—á—á–∏
–ù–∞–ø–∏—à–∏—Ç–µ –≥–æ—Ä—É—Ç–∏–Ω—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã—á–∏—Å–ª—è–µ—Ç N-–æ–µ —á–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–∞–Ω–∞–ª.

### –ó–∞–¥–∞—á–∞ 5: –ü–∏–Ω–≥-–ø–æ–Ω–≥
–°–æ–∑–¥–∞–π—Ç–µ –¥–≤–µ –≥–æ—Ä—É—Ç–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ø–µ—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–≤–æ–¥—è—Ç "ping" –∏ "pong" 10 —Ä–∞–∑.

### –ó–∞–¥–∞—á–∞ 6: Fan-out
–°–æ–∑–¥–∞–π—Ç–µ –æ–¥–Ω—É –≥–æ—Ä—É—Ç–∏–Ω—É-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞.

### –ó–∞–¥–∞—á–∞ 7: Timeout
–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—É —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ (timeout).

### –ó–∞–¥–∞—á–∞ 8: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–°–æ–∑–¥–∞–π—Ç–µ –≥–æ—Ä—É—Ç–∏–Ω—É, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω —Å –ø–æ–º–æ—â—å—é `runtime.NumGoroutine()`.
