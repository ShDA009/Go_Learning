# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥–æ—Ä—É—Ç–∏–Ω –∏ WaitGroup

## üí° –ö–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏

1. **sync.WaitGroup** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –≥–æ—Ä—É—Ç–∏–Ω
2. **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å—á—ë—Ç—á–∏–∫** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω
3. **Add(n)** ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –Ω–∞ n (—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã)
4. **Done()** ‚Äî —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –Ω–∞ 1 (—Å–∏–≥–Ω–∞–ª –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏)
5. **Wait()** ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∫–∞ —Å—á—ë—Ç—á–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç 0
6. **–ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é** ‚Äî WaitGroup –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –∫–∞–∫ `*sync.WaitGroup`

---

## üìñ –¢–µ–æ—Ä–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –∫–∞–∫ –¥–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ä—É—Ç–∏–Ω—ã?

```go
func main() {
    go heavyWork()
    // –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è heavyWork!
}
```

–ì–ª–∞–≤–Ω–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –Ω–µ –∑–Ω–∞–µ—Ç, —á—Ç–æ –¥—Ä—É–≥–∏–µ –µ—â—ë —Ä–∞–±–æ—Ç–∞—é—Ç.

### –†–µ—à–µ–Ω–∏–µ: sync.WaitGroup

`WaitGroup` ‚Äî —ç—Ç–æ —Å—á—ë—Ç—á–∏–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω:

```go
var wg sync.WaitGroup

wg.Add(3)    // –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ 3 –≥–æ—Ä—É—Ç–∏–Ω—ã
// ... –≥–æ—Ä—É—Ç–∏–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç ...
wg.Done()    // –û–¥–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å (—Å—á—ë—Ç—á–∏–∫ = 2)
wg.Done()    // –ï—â—ë –æ–¥–Ω–∞ (—Å—á—ë—Ç—á–∏–∫ = 1)
wg.Done()    // –ü–æ—Å–ª–µ–¥–Ω—è—è (—Å—á—ë—Ç—á–∏–∫ = 0)
wg.Wait()    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ —Å—á—ë—Ç—á–∏–∫ = 0
```

### –¢—Ä–∏ –º–µ—Ç–æ–¥–∞ WaitGroup

| –ú–µ—Ç–æ–¥ | –î–µ–π—Å—Ç–≤–∏–µ |
|-------|----------|
| `Add(n)` | –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –Ω–∞ n |
| `Done()` | –£–º–µ–Ω—å—à–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –Ω–∞ 1 (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç `Add(-1)`) |
| `Wait()` | –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø–æ–∫–∞ —Å—á—ë—Ç—á–∏–∫ > 0 |

### –ü–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```go
func main() {
    var wg sync.WaitGroup
    
    for i := 0; i < 5; i++ {
        wg.Add(1)           // –î–æ –∑–∞–ø—É—Å–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã!
        go func(id int) {
            defer wg.Done() // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã–∑–æ–≤–µ—Ç—Å—è
            work(id)
        }(i)
    }
    
    wg.Wait()  // –ñ–¥—ë–º –≤—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã
    fmt.Println("–í—Å–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å")
}
```

### –í–∞–∂–Ω–æ: Add() –¥–æ go!

```go
// –ü–†–ê–í–ò–õ–¨–ù–û
wg.Add(1)
go worker()

// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –≥–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö!
go func() {
    wg.Add(1)  // –ú–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ Wait()
    // ...
}()
wg.Wait()
```

### –í–∞–∂–Ω–æ: –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é

```go
// –ü–†–ê–í–ò–õ–¨–ù–û
func worker(wg *sync.WaitGroup) {
    defer wg.Done()
}

// –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ–ø–∏—è!
func worker(wg sync.WaitGroup) {
    defer wg.Done()  // –£–º–µ–Ω—å—à–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –∫–æ–ø–∏–∏
}
```

### defer wg.Done() ‚Äî –≤—Å–µ–≥–¥–∞!

`defer` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ –¥–∞–∂–µ –ø—Ä–∏ panic:

```go
func worker(wg *sync.WaitGroup) {
    defer wg.Done()  // –í—ã–∑–æ–≤–µ—Ç—Å—è –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
    
    // –î–∞–∂–µ –µ—Å–ª–∏ –∑–¥–µ—Å—å panic
    riskyOperation()
}
```

### –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WaitGroup

- –ù—É–∂–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–Ω–∞–ª—ã
- –û–¥–Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–Ω–∞–ª
- –°–ª–æ–∂–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–Ω–∞–ª—ã + select

---

## üìã –°–∏–Ω—Ç–∞–∫—Å–∏—Å

### –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```go
var wg sync.WaitGroup

wg.Add(n)    // –¥–æ–±–∞–≤–∏—Ç—å n –≥–æ—Ä—É—Ç–∏–Ω –≤ –≥—Ä—É–ø–ø—É
wg.Done()    // —É–º–µ–Ω—å—à–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –Ω–∞ 1 (–æ–±—ã—á–Ω–æ defer wg.Done())
wg.Wait()    // –∂–¥–∞—Ç—å –ø–æ–∫–∞ —Å—á—ë—Ç—á–∏–∫ –Ω–µ —Å—Ç–∞–Ω–µ—Ç 0
```

### –ü–µ—Ä–µ–¥–∞—á–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—é

```go
func worker(wg *sync.WaitGroup) {  // —É–∫–∞–∑–∞—Ç–µ–ª—å!
    defer wg.Done()
    // —Ä–∞–±–æ—Ç–∞
}
```

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä WaitGroup

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func worker(id int, wg *sync.WaitGroup) {
    defer wg.Done()  // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã–∑–æ–≤–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    
    fmt.Printf("Worker %d starting\n", id)
    time.Sleep(time.Second)
    fmt.Printf("Worker %d done\n", id)
}

func main() {
    var wg sync.WaitGroup
    
    for i := 1; i <= 5; i++ {
        wg.Add(1)          // —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É
        go worker(i, &wg)  // –ø–µ—Ä–µ–¥–∞—ë–º —É–∫–∞–∑–∞—Ç–µ–ª—å
    }
    
    wg.Wait()  // –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω
    fmt.Println("All workers completed!")
}
```

### WaitGroup —Å –∞–Ω–æ–Ω–∏–º–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func main() {
    var wg sync.WaitGroup
    
    tasks := []string{"task1", "task2", "task3"}
    
    for _, task := range tasks {
        wg.Add(1)
        go func(t string) {
            defer wg.Done()
            
            fmt.Printf("Processing %s...\n", t)
            time.Sleep(500 * time.Millisecond)
            fmt.Printf("Completed %s\n", t)
        }(task)
    }
    
    wg.Wait()
    fmt.Println("All tasks done!")
}
```

### –°–±–æ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ—Ç –≥–æ—Ä—É—Ç–∏–Ω

```go
package main

import (
    "fmt"
    "sync"
)

func factorial(n int, results chan<- int, wg *sync.WaitGroup) {
    defer wg.Done()
    
    result := 1
    for i := 2; i <= n; i++ {
        result *= i
    }
    results <- result
}

func main() {
    var wg sync.WaitGroup
    results := make(chan int, 5)  // –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
    
    numbers := []int{3, 5, 7, 10, 12}
    
    for _, n := range numbers {
        wg.Add(1)
        go factorial(n, results, &wg)
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω
    go func() {
        wg.Wait()
        close(results)
    }()
    
    // –ß–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    for result := range results {
        fmt.Println("Factorial:", result)
    }
}
```

### –ü–∞—Ç—Ç–µ—Ä–Ω: Add –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
package main

import (
    "fmt"
    "sync"
)

func main() {
    var wg sync.WaitGroup
    
    // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: Add –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –î–û –∑–∞–ø—É—Å–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã
    for i := 0; i < 3; i++ {
        wg.Add(1)
        go func(id int) {
            defer wg.Done()
            fmt.Println("Worker", id)
        }(i)
    }
    
    wg.Wait()
    
    // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: Add –≤–Ω—É—Ç—Ä–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã
    // for i := 0; i < 3; i++ {
    //     go func(id int) {
    //         wg.Add(1)  // –≥–æ–Ω–∫–∞! Wait –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è —Ä–∞–Ω—å—à–µ
    //         defer wg.Done()
    //         fmt.Println("Worker", id)
    //     }(i)
    // }
}
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func processItem(id int, sem chan struct{}, wg *sync.WaitGroup) {
    defer wg.Done()
    
    sem <- struct{}{}        // –∑–∞–Ω–∏–º–∞–µ–º —Å–ª–æ—Ç
    defer func() { <-sem }() // –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å–ª–æ—Ç
    
    fmt.Printf("Processing item %d\n", id)
    time.Sleep(time.Second)
    fmt.Printf("Done item %d\n", id)
}

func main() {
    var wg sync.WaitGroup
    
    // –°–µ–º–∞—Ñ–æ—Ä: –º–∞–∫—Å–∏–º—É–º 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω—ã
    semaphore := make(chan struct{}, 3)
    
    for i := 1; i <= 10; i++ {
        wg.Add(1)
        go processItem(i, semaphore, &wg)
    }
    
    wg.Wait()
    fmt.Println("All items processed!")
}
```

### –í–ª–æ–∂–µ–Ω–Ω—ã–µ WaitGroups

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

func task(id int, wg *sync.WaitGroup) {
    defer wg.Done()
    fmt.Printf("Task %d running\n", id)
    time.Sleep(100 * time.Millisecond)
}

func batch(batchID int, taskCount int, mainWg *sync.WaitGroup) {
    defer mainWg.Done()
    
    var batchWg sync.WaitGroup
    
    fmt.Printf("Batch %d: starting %d tasks\n", batchID, taskCount)
    
    for i := 1; i <= taskCount; i++ {
        batchWg.Add(1)
        go task(i, &batchWg)
    }
    
    batchWg.Wait()
    fmt.Printf("Batch %d: completed\n", batchID)
}

func main() {
    var mainWg sync.WaitGroup
    
    for batch := 1; batch <= 3; batch++ {
        mainWg.Add(1)
        go batch(batch, 4, &mainWg)
    }
    
    mainWg.Wait()
    fmt.Println("All batches completed!")
}
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –≤–µ–±-—Å–∫—Ä–∞–ø–µ—Ä

```go
package main

import (
    "fmt"
    "sync"
    "time"
)

type Result struct {
    URL     string
    Status  string
    Latency time.Duration
}

func fetchURL(url string, results chan<- Result, wg *sync.WaitGroup) {
    defer wg.Done()
    
    start := time.Now()
    
    // –ò–º–∏—Ç–∞—Ü–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–∞
    time.Sleep(time.Duration(100+len(url)*10) * time.Millisecond)
    
    results <- Result{
        URL:     url,
        Status:  "200 OK",
        Latency: time.Since(start),
    }
}

func main() {
    urls := []string{
        "https://google.com",
        "https://github.com",
        "https://golang.org",
        "https://amazon.com",
        "https://microsoft.com",
    }
    
    var wg sync.WaitGroup
    results := make(chan Result, len(urls))
    
    start := time.Now()
    
    for _, url := range urls {
        wg.Add(1)
        go fetchURL(url, results, &wg)
    }
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª –∫–æ–≥–¥–∞ –≤—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã
    go func() {
        wg.Wait()
        close(results)
    }()
    
    // –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    fmt.Println("Results:")
    for result := range results {
        fmt.Printf("  %s - %s (%v)\n", result.URL, result.Status, result.Latency)
    }
    
    fmt.Printf("\nTotal time: %v\n", time.Since(start))
}
```

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### 1. –ü–µ—Ä–µ–¥–∞—á–∞ WaitGroup –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é

```go
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–æ–ø–∏—è
func worker(wg sync.WaitGroup) {
    defer wg.Done()  // –∏–∑–º–µ–Ω—è–µ—Ç –∫–æ–ø–∏—é!
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —É–∫–∞–∑–∞—Ç–µ–ª—å
func worker(wg *sync.WaitGroup) {
    defer wg.Done()
}
```

### 2. Add –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã

```go
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –≥–æ–Ω–∫–∞ –¥–∞–Ω–Ω—ã—Ö
go func() {
    wg.Add(1)  // –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ wg.Wait()
    defer wg.Done()
}()
wg.Wait()

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî Add –¥–æ –∑–∞–ø—É—Å–∫–∞
wg.Add(1)
go func() {
    defer wg.Done()
}()
wg.Wait()
```

### 3. –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫

```go
var wg sync.WaitGroup

wg.Add(1)
wg.Done()
wg.Done()  // ‚ùå PANIC: negative WaitGroup counter

// ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Done –¥–æ–ª–∂–Ω–æ —Ä–∞–≤–Ω—è—Ç—å—Å—è Add
wg.Add(2)
wg.Done()
wg.Done()  // OK
```

### 4. –ó–∞–±—ã–ª–∏ Done()

```go
func worker(wg *sync.WaitGroup) {
    // ‚ùå –ó–∞–±—ã–ª–∏ wg.Done() ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–∏—Å–Ω–µ—Ç
    fmt.Println("Working...")
}

func worker(wg *sync.WaitGroup) {
    defer wg.Done()  // ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer
    fmt.Println("Working...")
}
```

### 5. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ WaitGroup

```go
var wg sync.WaitGroup

// –ü–µ—Ä–≤–∞—è –≥—Ä—É–ø–ø–∞
wg.Add(2)
go func() { wg.Done() }()
go func() { wg.Done() }()
wg.Wait()

// ‚ö†Ô∏è –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –ü–û–°–õ–ï Wait()
wg.Add(1)
go func() { wg.Done() }()
wg.Wait()
```

---

## üèãÔ∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: defer –±–∞–∑–æ–≤—ã–π

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ü–µ—Ä–≤—ã–π
–í—Ç–æ—Ä–æ–π
–¢—Ä–µ—Ç–∏–π (defer)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- defer –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ü–æ—Å–ª–µ –æ–±—ã—á–Ω–æ–≥–æ –∫–æ–¥–∞
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- defer fmt.Println(...)
- –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

func main() {
    defer fmt.Println("–¢—Ä–µ—Ç–∏–π (defer)")
    fmt.Println("–ü–µ—Ä–≤—ã–π")
    fmt.Println("–í—Ç–æ—Ä–æ–π")
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–ü–µ—Ä–≤—ã–π
–í—Ç–æ—Ä–æ–π
–¢—Ä–µ—Ç–∏–π (defer)
```

**–ë–∞–ª–ª—ã:** 5

### –ó–∞–¥–∞–Ω–∏–µ 2: defer LIFO –ø–æ—Ä—è–¥–æ–∫

–ü–æ–∫–∞–∂–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö defer.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
defer 3
defer 2
defer 1
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- –ù–µ—Å–∫–æ–ª—å–∫–æ defer
- LIFO: –ø–æ—Å–ª–µ–¥–Ω–∏–π-–ø–µ—Ä–≤—ã–π
- –°—Ç–µ–∫ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- –ö–∞–∫ —Å—Ç–µ–∫: push, push, push, pop, pop, pop
- –ü–æ—Å–ª–µ–¥–Ω–∏–π defer –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

func main() {
    defer fmt.Println("defer 1")
    defer fmt.Println("defer 2")
    defer fmt.Println("defer 3")
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
defer 3
defer 2
defer 1
```

**–ë–∞–ª–ª—ã:** 10

### –ó–∞–¥–∞–Ω–∏–µ 3: defer –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Ä–µ—Å—É—Ä—Å–∞.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç
–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–º...
–§–∞–π–ª –∑–∞–∫—Ä—ã—Ç
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- defer file.Close() —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
- –î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- –ò–¥–∏–æ–º–∞: open, defer close
- –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É open

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

type File struct{}
func (f *File) Close() { fmt.Println("–§–∞–π–ª –∑–∞–∫—Ä—ã—Ç") }

func main() {
    f := &File{}
    defer f.Close()
    fmt.Println("–§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç")
    fmt.Println("–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–º...")
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–§–∞–π–ª –æ—Ç–∫—Ä—ã—Ç
–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–º...
–§–∞–π–ª –∑–∞–∫—Ä—ã—Ç
```

**–ë–∞–ª–ª—ã:** 15

### –ó–∞–¥–∞–Ω–∏–µ 4: defer —Å –∞–Ω–æ–Ω–∏–º–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer —Å –∞–Ω–æ–Ω–∏–º–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: 42
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- defer func() {...}()
- –ó–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ —Å—Å—ã–ª–∫–µ
- –í–∏–¥–∏—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- –ê–Ω–æ–Ω–∏–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç defer —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

// TODO: –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–¥–∞–Ω–∏—é
// TODO: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer

func main() {
    // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: 42
```

**–ë–∞–ª–ª—ã:** 15

### –ó–∞–¥–∞–Ω–∏–µ 5: defer –∏ return

–ü–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ defer –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ: 2
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:**
- –ò–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- defer –∏–∑–º–µ–Ω—è–µ—Ç –µ–≥–æ
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–Ω–æ –≤—ã–∑—ã–≤–∞—é—â–µ–º—É

**–ü–æ–¥—Å–∫–∞–∑–∫–∏:**
- func f() (result int) {...}
- defer –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å result

**–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:**
```go
package main

import "fmt"

// TODO: –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–¥–∞–Ω–∏—é
// TODO: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ defer

func main() {
    // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å
    
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ: 2
```

**–ë–∞–ª–ª—ã:** 25
